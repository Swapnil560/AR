import"../chunks/DsnmJJEf.js";import{i as Y}from"../chunks/CqFuAgG6.js";import{o as Z}from"../chunks/CE2YfgCx.js";import{p as tt,f as m,a as l,b as at,a2 as x,a4 as o,s as r,m as p,a3 as et,g as a,a6 as U,a0 as $,$ as j}from"../chunks/ff_rkm8t.js";import{e as C}from"../chunks/Cwbhm3pK.js";import{i as _}from"../chunks/CNscv0VA.js";import{s as v}from"../chunks/DVKhVmrb.js";import{b as A}from"../chunks/CtliRwTt.js";import{s as ot,a as rt}from"../chunks/cDvUGcvK.js";import{s as st}from"../chunks/Dsdo-wuW.js";const it=()=>{const s=st;return{page:{subscribe:s.page.subscribe},navigating:{subscribe:s.navigating.subscribe},updated:s.updated}},nt={subscribe(s){return it().page.subscribe(s)}};var ct=m('<img width="640" height="480" style="position:absolute;left:0;top:0;pointer-events:none;"/>'),dt=m("<button>Start Video (20s max)</button>"),lt=m("<button>Stop Video</button>"),pt=m('<h2>Photo Preview</h2> <img width="320"/> <br/> <a download="rongcam-photo.png">Download Photo</a> <a target="_blank">Share on WhatsApp</a>',1),vt=m('<h2>Video Preview</h2> <video controls width="320"></video> <br/> <a download="rongcam-video.webm">Download Video</a>',3),mt=m('<main><h1>AR Camera</h1> <div style="position:relative; width:640px; height:480px;"><video width="640" height="480" autoplay style="position:absolute;left:0;top:0;"></video> <!> <canvas width="640" height="480" style="display:none;"></canvas></div> <div style="margin-top:1em;"><button>Capture Photo</button> <!></div> <!> <!></main>',2);function xt(s,I){tt(I,!1);const[M,O]=ot(),B=()=>rt(nt,"$page",M);let i=p(),u=p(),c=p(!1),n=null,w=[],d=p(null),g=p(null),f=p(null);Z(async()=>{const t=B().params.id;r(f,sessionStorage.getItem("filter_"+t)),await T()});async function T(){const t=await navigator.mediaDevices.getUserMedia({video:!0,audio:!0});et(i,a(i).srcObject=t),await a(i).play()}function W(){const t=a(u).getContext("2d");if(t.drawImage(a(i),0,0,640,480),a(f)){const e=new window.Image;e.src=a(f),e.onload=()=>{t.drawImage(e,0,0,640,480),r(d,a(u).toDataURL("image/png"))}}else r(d,a(u).toDataURL("image/png"))}async function q(){r(c,!0),r(g,null),w=[];const t=a(i).srcObject;n=new MediaRecorder(t),n.ondataavailable=e=>w.push(e.data),n.onstop=()=>{const e=new Blob(w,{type:"video/webm"});r(g,URL.createObjectURL(e)),r(c,!1)},n.start(),setTimeout(()=>{n&&a(c)&&P()},2e4)}function P(){n&&a(c)&&(n.stop(),r(c,!1))}Y();var y=mt(),R=o(x(y),2),D=x(R);A(D,t=>r(i,t),()=>a(i));var S=o(D,2);{var z=t=>{var e=ct();$(()=>v(e,"src",a(f))),l(t,e)};_(S,t=>{a(f)&&t(z)})}var E=o(S,2);A(E,t=>r(u,t),()=>a(u)),U(R);var k=o(R,2),V=x(k),F=o(V,2);{var G=t=>{var e=dt();C("click",e,q),l(t,e)},H=t=>{var e=lt();C("click",e,P),l(t,e)};_(F,t=>{a(c)?t(H,!1):t(G)})}U(k);var L=o(k,2);{var J=t=>{var e=pt(),b=o(j(e),2),h=o(b,4),Q=o(h,2);$(X=>{v(b,"src",a(d)),v(h,"href",a(d)),v(Q,"href",X)},[()=>`https://wa.me/?text=Check%20my%20AR%20photo!&url=${encodeURIComponent(a(d))}`]),l(t,e)};_(L,t=>{a(d)&&t(J)})}var K=o(L,2);{var N=t=>{var e=vt(),b=o(j(e),2),h=o(b,4);$(()=>{v(b,"src",a(g)),v(h,"href",a(g))}),l(t,e)};_(K,t=>{a(g)&&t(N)})}U(y),C("click",V,W),l(s,y),at(),O()}export{xt as component};
